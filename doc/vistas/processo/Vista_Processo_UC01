@startuml

participant "main" as MAIN
participant "utils" as UTILS
participant "Thread" as THRD
participant "cmd" as CMD
participant "Intel Power Gadget" as IPG
participant "Nvidia System Management Interface" as SMI

activate MAIN
MAIN -> UTILS: initialize_files()
activate UTILS
deactivate UTILS

MAIN -> THRD**: create(target = process_cpu_usage, args = 0)

MAIN-> CMD: pid = get_gpu_report(filename, interval)
activate CMD
CMD -> SMI : nvidia-smi --query-gpu=timestamp,power.draw -lms interval >> filename.csv
deactivate

MAIN -> THRD: start()
activate THRD
loop 
THRD -> THRD: get_cpu_percentage(pid)
end loop 

MAIN -> CMD: get_process_report(save_file_name, command)
activate CMD
CMD -> IPG: powerlog.exe -file save_file_name -cmd command
activate IPG
deactivate IPG
deactivate CMD

MAIN -> THRD : join()
deactivate THRD

MAIN -> CMD: kill_process(pid)
activate CMD
deactivate


MAIN -> MAIN: estimate_process_power_consumption()

MAIN -> MAIN: save_results()

@enduml